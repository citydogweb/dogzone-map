<!--
@license
Copyright (c) 2016
Please feel free to use this element in any way you like.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../google-map/google-map.html">
<link rel="import" href="dogzone-detail.html">
<!-- all used icons to not load full iconsets -->


<!--
An element providing a map of all dog parks in Vienna.

Example:

    <dogzone-map></dogzone-map>

@demo

-->
<dom-module id="dogzone-map">
  <template>
    <style>
      :host {
        position: relative;
        display: block;
        height: 100%;
      }

      #map {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
      #infocontainer {
        /*background-color: #FFF8E1;*/
        position: absolute;
        height: 80%;
        width: 28%;
        right: 32px;
        bottom: 10%;
      }
    </style>

    <iron-ajax auto url="http://data.wien.gv.at/daten/geo/" params='{"service":"WFS", "request":"getFeature", "version":"1.1.0", "typeName":"ogdwien:HUNDEZONEOGD", "srsName":"EPSG:4326", "outputFormat":"json"}' handleAs="json" on-response="_handleParks" on-error="handleParkError"></iron-ajax>
    <google-map id="map" disable-default-ui fit-to-markers click-events on-google-map-click="_handleMapClick" click-events>
      <template is="dom-repeat" items="[[coords]]" as="coord">
        <google-map-marker latitude="[[coord.geometry.coordinates.1]]" longitude="[[coord.geometry.coordinates.0]]" title="[[coord.properties.PARK]]" icon="[[parkIconUrl]]" on-google-map-marker-click="_handleClick" click-events>
        </google-map-marker>
      </template>
    </google-map>
    <dogzone-detail id="infocontainer"
                    name="[[selectedPark.properties.PARK]]"
                    typ="[[selectedPark.properties.TYP]]"
                    size="[[selectedPark.properties.FLAECHE]]"
                    longitude="[[selectedPark.geometry.coordinates.0]]"
                    latitude="[[selectedPark.geometry.coordinates.1]]"
                    hidden="true"></dogzone-detail>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'dogzone-map',
    properties: {

      /**
       * A custom icon path for map markers
       */
      parkIconUrl: {
        type: String,
        // value: '../dog.png'
        value: 'https://raw.githubusercontent.com/citydogweb/dogzone-map/master/dog_map_icon.png'
          //value: 'map-iconset-svg:close'
      },

      /**
       * A Object of the currently selected park
       */
      selectedPark: {
        type: Object,
        value: function() {
          return {};
        }
      },

      /**
       * Coordinates of dog parks
       */
      coords: {
        type: Array
      }
    },

    ready: function() {},

    _handleParks: function(event, response) {
      this.coords = response.response.features;
    },

    _handleMapClick: function(event) {
      this.$.infocontainer.hidden = true;

    },

    _handleClose: function(event) {
      this.$.infocontainer.hidden = true;
    },

    _handleClick: function(marker) {
      //get index from marker and use it to get park-node from COORDS(ajax-response)
      this.selectedPark = this.coords[marker.model.__data__.index];
      this.$.infocontainer.hidden = false;



    }
  });
</script>
